function structg(command)% Calculate structure factor% Copyright 1996 Anneli Munkholm & Sean Brennan.% Stanford Synchrotron Radiation Laboratory% Stanford Linear Accelerator Center, Stanford CA 94309% bren@slac.stanford.edu; munkholm@anl.govglobal DISK_PATH DISK_END ANOMAL_FILES DISK_DELIMglobal STR_LATTICEif nargin==0 % initialize window	struct_i;	rdlat('silicon');	return;endif strcmp(command,'crystal_name')	noread= rdlat(get(findobj(gcf,'tag','crystal'),'string'));	if noread, 		disp('File not found')	else		disp('File loaded')	endelseif strcmp(command,'push_name')	eval(['cd ',DISK_PATH,ANOMAL_FILES,DISK_DELIM,'lat_dir']);	[filename, pathname] = uigetfile('*.mat','Crystal file for structg');	if filename		set(findobj(gcf,'tag','crystal'),'String',filename(1:length(filename)-4));		rdlat(filename(1:length(filename)-4));	endelseif strcmp(command,'energy')	energy= str2num(get(findobj(gcf,'tag','str_energ'),'string'));	set(findobj('tag','str_lambd'),'string',num2str(fhc/energy)); elseif strcmp(command,'lambda')	lambda= str2num(get(findobj(gcf,'tag','str_lambd'),'string'));	set(findobj(gcf,'tag','str_energ'),'string',num2str(fhc/lambda)); elseif strcmp(command,'update')	%% read values	h=str2num(get(findobj(gcf,'tag','h'),'string'));	k=str2num(get(findobj(gcf,'tag','k'),'string'));	l=str2num(get(findobj(gcf,'tag','l'),'string'));	energy= str2num(get(findobj(gcf,'tag','str_energ'),'string'));	lambda= str2num(get(findobj(gcf,'tag','str_lambd'),'string'));	t_cryst= str2num(get(findobj(gcf,'tag','t_cryst'),'string'));	%% calculate output	[cd_f0, thetab, gamma, d_dsp, rho_ave, vol] = ...			struct_f( 0, 0, 0, energy, t_cryst);	[cd_fh, thetab, gamma, d_dsp, rho_ave, vol] = ...			struct_f( h, k, l, energy, t_cryst);	[cd_fh_m, thetab, gamma, d_dsp, rho_ave, vol] = ...			struct_f( -h, -k, -l, energy, t_cryst);	if thetab == 0,		error(sprintf(' Minimum energy is: %f',fhc/(2*d_dsp)))	end	theta_rad=thetab*pi/180;	f_sq=0.5*(abs(cd_fh)^2+abs(cd_fh_m)^2);	f0_sq=abs(cd_f0)^2;	w_darwin= (2*f_e_rad*sqrt(f_sq)*lambda^2)/(pi*vol*sind(2*thetab)); % rad	w_darwin= w_darwin*3600*180/pi;		% arc-seconds	abs_depth=(1e-4*lambda*sind(thetab))/(4*pi*gamma*imag(cd_f0)); %microns	abs_length=(1e-4*lambda)/(2*pi*gamma*imag(cd_f0)); %micronsif f_sq>0		ex_depth= 1e-4*vol/(2*d_dsp*f_e_rad*sqrt(f_sq));	% microns	%		ex_depth=1e-4*cosd(thetab)*lambda/(gamma*sqrt(f_sq));	else		ex_depth=0;	end	chi=gamma.*[cd_f0 cd_fh cd_fh_m];	%% update screen	if sign(imag(cd_f0))==-1,str_0='';else,str_0='+';end	if sign(imag(cd_fh))==-1,str_h='';else,str_h='+';end	if sign(imag(cd_fh_m))==-1,str_hm='';else,str_hm='+';end	set(findobj(gcf,'tag','F0_real'),'string',num2str(real(cd_f0))); 	set(findobj(gcf,'tag','F0_imag'),'string',[str_0,num2str(imag(cd_f0)),' i']); 	set(findobj(gcf,'tag','FH_real'),'string',num2str(real(cd_fh))); 	set(findobj(gcf,'tag','FH_imag'),'string',[str_h,num2str(imag(cd_fh)),' i']); 	set(findobj(gcf,'tag','FHm_real'),'string',num2str(real(cd_fh_m))); 	set(findobj(gcf,'tag','FHm_imag'),'string',[str_hm,num2str(imag(cd_fh_m)),' i']); 	set(findobj(gcf,'tag','Chi0_real'),'string',num2str(real(chi(1)))); 	set(findobj(gcf,'tag','Chi0_imag'),'string',[str_0,num2str(imag(chi(1))),' i']); 	set(findobj(gcf,'tag','ChiH_real'),'string',num2str(real(chi(2)))); 	set(findobj(gcf,'tag','ChiH_imag'),'string',[str_h,num2str(imag(chi(2))),' i']); 	set(findobj(gcf,'tag','ChiHm_real'),'string',num2str(real(chi(3)))); 	set(findobj(gcf,'tag','ChiHm_imag'),'string',[str_hm,num2str(imag(chi(3))),' i']); 	set(findobj(gcf,'tag','abslength'),'string',num2str(abs_length)); 	set(findobj(gcf,'tag','absdepth'),'string',num2str(abs_depth)); 	set(findobj(gcf,'tag','extdepth'),'string',num2str(ex_depth)); 	set(findobj(gcf,'tag','darwin'),'string',num2str(w_darwin)); 	set(findobj(gcf,'tag','f_sq'),'string',num2str(f_sq)); 	set(findobj(gcf,'tag','F/F0'),'string',num2str(sqrt(f_sq/f0_sq))); 	set(findobj(gcf,'tag','gamma'),'string',num2str(gamma)); 	set(findobj(gcf,'tag','dspace'),'string',sprintf('%-8.5f',d_dsp)); 	set(findobj(gcf,'tag','bragg_rad'),'string',sprintf('%-7.5f',theta_rad)); 	set(findobj(gcf,'tag','bragg_deg'),'string',sprintf('%-8.4f',thetab)); 	set(findobj(gcf,'tag','volume'),'string',num2str(vol)); 	set(findobj(gcf,'tag','density'),'string',num2str(rho_ave)); 	set(findobj(gcf,'tag','a0'),'string',num2str(STR_LATTICE(1)));	set(findobj(gcf,'tag','b0'),'string',num2str(STR_LATTICE(2)));	set(findobj(gcf,'tag','c0'),'string',num2str(STR_LATTICE(3)));	set(findobj(gcf,'tag','al'),'string',num2str(STR_LATTICE(4)));	set(findobj(gcf,'tag','be'),'string',num2str(STR_LATTICE(5)));	set(findobj(gcf,'tag','ga'),'string',num2str(STR_LATTICE(6)));end