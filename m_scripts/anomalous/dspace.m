function [dsp, vol] = dspace( h, k, l, t_cryst )% Calculate d-spacing and unit cell volume% RDLAT must be called in advance%% Usage: [dsp, vol] = dspace( h, k, l, t_cryst )% Fortran version written by Sean Brennan at SSRL, described in% S. Brennan and P.L. Cowan, Rev. Sci. Instrum., 63, 850 (1992).% V3.0 ported to MATLAB, Alex Lessmann (1.0)global  STR_LATTICE STR_TEMP_COEFa0_temp = STR_LATTICE(1) * (1 + STR_TEMP_COEF * 1e-6 * (t_cryst-293.15));b0_temp = STR_LATTICE(2) * (1 + STR_TEMP_COEF * 1e-6 * (t_cryst-293.15));c0_temp = STR_LATTICE(3) * (1 + STR_TEMP_COEF * 1e-6 * (t_cryst-293.15));calp = cosd( STR_LATTICE(4));salp = sind( STR_LATTICE(4));cbet = cosd( STR_LATTICE(5));sbet = sind( STR_LATTICE(5));cgam = cosd( STR_LATTICE(6));sgam = sind( STR_LATTICE(6));     trig_vol = 1 + 2*calp*cbet*cgam - calp^2 - cbet^2 - cgam^2;vol = a0_temp * b0_temp * c0_temp * sqrt( trig_vol );dsq_inv = (h^2 * salp^2 / a0_temp^2 + ...		k^2 * sbet^2 / b0_temp^2 + ...		l^2 * sgam^2 / c0_temp^2 + ...		2*h*k * (calp*cbet - cgam) / (a0_temp * b0_temp) + ...		2*k*l * (cbet*cgam - calp) / (b0_temp * c0_temp) + ...		2*l*h * (cgam*calp - cbet) / (c0_temp * a0_temp)) / trig_vol;if abs( dsq_inv ) > 1e-12    dsp = sqrt( 1/dsq_inv );else    dsp = 0;endreturn