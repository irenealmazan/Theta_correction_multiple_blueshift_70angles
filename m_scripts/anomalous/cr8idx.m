function cr8idx(command) %  cr8idx.m %  gui version of cr8index     % Copyright 1996 Anneli Munkholm & Sean Brennan.% Stanford Synchrotron Radiation Laboratory% Stanford Linear Accelerator Center, Stanford CA 94309% bren@slac.stanford.edu; munkholm@anl.govif nargin == 0 	command = 'init';end if isstr(command) 	if strcmp(command,'init') 		idx_i;	elseif strcmp(command,'expt')		dens=str2num(get(findobj(gcf,'tag','dens'),'string'));		alpha=str2num(get(findobj(gcf,'tag','alpha'),'string'));		if isempty(alpha),return; end    % stop if nothing to export		beta=str2num(get(findobj(gcf,'tag','beta'),'string'));		mu=str2num(get(findobj(gcf,'tag','mu'),'string'));		z= get(findobj(gcf,'tag','zed1'),'String');        nogo=strcmp(z,'');		if nogo,			break;		else			if length(z) >2				j=size(comps,1);				if j<5,					comps(j+1:5,:)= [NaN NaN];				end			else				z=element(z);				comps(1,1)=z;				comps(1,2)=str2num(get(findobj(gcf,'tag','fra1'),'string'));				for j=2:5					ztag=['zed' num2str(j)];					ftag=['fra' num2str(j)];		            nogo=strcmp(get(findobj(gcf,'tag',ztag),'String'),'');								if nogo, 						comps(j,:)=[NaN NaN]; 					else						z=get(findobj(gcf,'tag',ztag),'string');						z=element(z);						comps(j,1)=z;						comps(j,2)=str2num(get(findobj(gcf,'tag',ftag),'string'));					end				end			end					data=[dens alpha beta mu comps(:)'];			title=get(gcf,'name');			multig(['cr8i_' title(1:4)],data);		end	elseif strcmp(command(1:3),'fra')		frac_nr=str2num(command(4));		frac=str2num(get(gco,'string'));		if ~isempty(frac),			for j=1:str2num(command(4)) 				dfrac(j)=str2num(get(findobj(gcf,'tag',['fra' num2str(j)]),'string'));			end			frac_sum=1-sum(dfrac); 			if frac_sum==0,				for j=1:5-frac_nr					set(findobj(gcf,'tag',['fra' num2str(frac_nr+j)]),...					           'string','');						set(findobj(gcf,'tag',['zed' num2str(frac_nr+j)]),...					           'string','');				end				else				set(findobj(gcf,'tag',['fra' num2str(frac_nr+1)]),...				           'string',num2str(frac_sum));			end		end	elseif strcmp(command,'upda')		energy=str2num(get(findobj(gcf,'tag','enrg'),'string'));		rho_t= str2num(get(findobj(gcf,'tag','dens'),'string'));		if isempty(rho_t), rho_t=0; end		for j=1:5			ztag=['zed' num2str(j)];			ftag=['fra' num2str(j)];            nogo=strcmp(get(findobj(gcf,'tag',ztag),'String'),'');						if nogo, break; end			z=get(findobj(gcf,'tag',ztag),'string');			if length( z) <= 2				z=element(z);				comps(j,1)=z;				comps(j,2)=str2num(get(findobj(gcf,'tag',ftag),'string'));			else				[rho_t,comps]=mtl_rd( z);				lcomp= size(comps,1);				if lcomp >5, error('  Too many components'); end				for j=1:lcomp					ztag=['zed' num2str(j)];					ftag=['fra' num2str(j)];					set(findobj(gcf,'tag',ztag),'string',num2str(comps(j,1)));					set(findobj(gcf,'tag',ftag),'string',num2str(comps(j,2)));				end			end		end		if rho_t==0 & sum(comps(:,2))~=1			disp('Sum of fractions doesn''t equal 1 !!!')			alpha=[]; beta=[]; mu=[];		else			[refract_index,mu,rho]= cr8index(energy,rho_t,comps);			alpha=1e6*(1-abs(refract_index));			beta=1e6*imag(refract_index);			mu=1e4*mu;		end		set(findobj(gcf,'tag','dens'),'string',num2str(rho));		set(findobj(gcf,'tag','alpha'),'string',num2str(alpha));		set(findobj(gcf,'tag','beta'),'string',num2str(beta));		set(findobj(gcf,'tag','mu'),'string',num2str(mu));	endend