function [din,sigi] = filmunro(in0,in1,in2,coh0,coh1,coh2)% FILMUNRO  fil an intensity matrix for PSFMUNRO% [din,sigi] = filmunro(in0,in1,in2,coh0,coh1,coh2)% input:% in0  intensity at one single energy (maybe far from edges)% in1  intensity matrix at absorption edge 1%      in1 = [i1 i2 ...] where the columns i1, i2... contain %       an intensity as a function of k at energy 1, 2...% in2  intensity matrix at absorption edge 2% coh0 <ff*> for the single energy%% Part of Ritva's original Matlab package% first column of din contains a total intensity curvedin(:,1)  = in0(:,1)-coh0(:,1);sigi(:,1) = in0(:,1);% the columns 2 ... n1+1 contain differences at edge one[m1,n1]=size(in1);for j = 2:n1,   din(:,j)  = in1(:,1)-in1(:,j)-(coh1(:,1)-coh1(:,j));   sigi(:,j) = in1(:,1)+in1(:,j);end;% the columns n1+2 ... contain differences at edge two% or another total intensity curve (if n2 = 1).[m2,n2]=size(in2);[d1,d2]=size(din);if n2 == 1,   din(:,1+d2)  = in2(:,1)-coh2(:,1);   sigi(:,1+d2) = in2(:,1);end;if (n2 >= 2),   for j = 2:n2,      din(:,j+d2-1)  = in2(:,1)-in2(:,j)-(coh2(:,1)-coh2(:,j));      sigi(:,j+d2-1) = in2(:,1)+in2(:,j);   end;end;j=find(sigi<=0);if isempty(j) == 0,   sigi(j)=j*0+0.001;end;