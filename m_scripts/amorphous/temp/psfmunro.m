function [saa,sab,sbb,sig,W] = psfmunro(din,xa,xb,...                                        fa0,fa1,fa2,fb0,fb1,fb2,regfac,sigi)% [saa,sab,sbb,sig,w] = psfmunro(din,xa,xb,fa0,fa1,fa2,fb0,fb1,fb2,regfac,sigi)% psfs of a two-component system% using one total intensity curve + several differences% input data:% din            input data matrix, form by means of filmunro% fa0,fb0        scattering factors of the two components% fa1,fb1        matrix of scattering factors at absorption edge 1%                fa1 = [f1 f2 ...], where f1,.. are columns containing%                scattering factors as a function of  k% fa2,fb2        matrix of scattering factors at absorption edge 2% xa,xb          atomic fractions of the components% regfac         regularization factor% sigi           variances of din% output data:% saa,sab,sbb    partial structure functions% sig            condition number[n1,n2] = size(din);saa = zeros(1,n1);  sab = zeros(1,n1);  sbb = zeros(1,n1); sig = zeros(1,n1);for j = 1:n1,   if isempty(fa2) == 0,        w = munrow(xa,xb,fa0(j,:),fa1(j,:),fa2(j,:),fb0(j,:),fb1(j,:),fb2(j,:));   else        w = munrow(xa,xb,fa0(j,:),fa1(j,:),[],fb0(j,:),fb1(j,:),[]);   end;   sig(j) = cond(w);      s = lsqreg2(w,din(j,:)',diag(sigi(j,:).^(-1)),regfac);         saa(j) = s(1);   sab(j) = s(2);   sbb(j) = s(3);      if j==1 | j==floor(n1/2) | j==n1,       if j==1, W=w; end;      disp(sprintf('point: %g', j))      disp('weighting matrix w in w*s=i: '),w      disp(sprintf('singular values, max/min: %g', sig(j))),cond(w)   end;end;% output at the smallest k