function usagetxt = usage(mfile)%USAGE Display definition line of function M-files %	Written by I. Kollar%	Last modified: 31-Oct-1994 perpos=find(mfile=='.');if isempty(perpos), mfile=[mfile,'.m']; endperpos=find(mfile=='.');if exist(mfile(1:perpos-1))==5  usagetxti=[mfile(1:perpos-1),' is a built-in function'];  disp(usagetxti)  if nargout>0, usagetxt=usagetxti; end   returnelseif exist(mfile(1:perpos-1))==1  usagetxti=[mfile(1:perpos-1),' is a variable'];  disp(usagetxti)  if nargout>0, usagetxt=usagetxti; end  returnend[fid,errmess]=fopen(mfile,'r');if fid==-1  disp(errmess)  if nargout>0, usagetxt=errmess; end  returnend%filestr=fread(fid); fclose(fid);filestr=setstr(filestr');if isempty(filestr), error(['File ',mfile,' is empty']), endindcr=[find((filestr==13)|(filestr==10)),length(filestr)+1]; %cr or lfif strcmp(filestr(1),'%') %Script M-file  usagetxti=[mfile,' is a script M-file',sprintf('\n'),...	filestr(2:indcr(1)-1)];  disp(usagetxti)  if nargout>0, usagetxt=usagetxti; end  returnendindf=find(filestr(1:indcr(1)-1)=='f');funM=0; %word 'function' foundfor i=indf(:)'  if strcmp('function',filestr(i:min(i+7,indcr(1)-1))) %word function found    funM=1; infobeg=i+8; ch1=filestr(infobeg);    while ((ch1>=9)&(ch1<=13))|(ch1==' ')      infobeg=infobeg+1; ch1=filestr(infobeg);    end %while    break  endend %for iif funM==0  usagetxti=[mfile,' is probably a script M-file',sprintf('\n'),...        filestr(2:indcr(1)-1)];  disp(usagetxti)  if nargout>0, usagetxt=usagetxti; endelse %function M-file  %look for continuing lines  beglin=1; indcri=1; endp=indcr(indcri)-1;  for i=1:5 %maximum 5 continuing lines    indp=find(filestr(beglin:indcr(indcri)-1)=='.');    for ii=indp      if beglin+ii-1>length(filestr)-2, break, end      if strcmp('...',filestr(beglin+ii-1+[0:2]))        beglin=indcr(indcri)+1;        indcri=indcri+1;        if (filestr(indcr(indcri-1))==13)&(filestr(indcr(indcri))==10)	  %cr-lf pair (PC)          indcri=indcri+1; beglin=beglin+1;	end        endp=indcr(indcri)-1;      end    end %for ii  end %for i  usagetxti=filestr(infobeg:endp);  disp(usagetxti)  if nargout>0, usagetxt=usagetxti; endend