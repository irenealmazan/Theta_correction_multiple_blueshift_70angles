function f=escatfa(z,s,sorq)% ESCATFA Calculation of electron elastic scattering amplitude%% Usage: f=escatfa(zed,s,sorq)%% Calculates the atomic scattering amplitudes (in Å) for electrons% from neutral atoms.%% Input:%   zed  =  atomic number%   s    =  magnitude of scattering vector (inv. Angstroms)%           By default, this is defined as s=2*sin(theta)/lambda, which%           is the convention for electron scattering.%   sorq =  Force the choise of s or q for the scattering vector.%           's' is the same as the default; scattering vectors are s=2*sin(theta)/lambda%			'q' or 'k' specifies that the input s is actually q=4*pi*sin(theta)/lambda%% Ouput:%	f	=	elastic scattering amplitude (Å)% Copyright 2000, Todd Hufnagel (hufnagel@jhu.edu)% Based on the parameterization in L.-M. Peng et al. Acta Cryst. A52, 257 (1996)% Requires: Data file escatter.mat in the appropriate subdirectory (usually% in the CALSCAT subdirectory). ELECTRON_FILES needs to point at this% directory. See the documentation.% 5-5-00 TCH Original version% 07-May-03 TCH Changed input to s=2*pi*sin(theta)/lambda% 15-May-03 TCH Changed ELECTRON_FILES to AMORPHOUS_FILESglobal DISK_PATH AMORPHOUS_FILES DISK_DELIMload([DISK_PATH AMORPHOUS_FILES DISK_DELIM 'escatter.mat'])s=s(:);if nargin<3    s=s/2;          % Parameterization actually uses sin(theta)/lambda.elseif ((lower(sorq(1))=='q')|(lower(sorq(1))=='k'))	s=s./(4*pi);    % Parameterization actually uses sin(theta)/lambda.end if max(s)>6	error('Parameterization not valid for sin(theta)/lambda > 6 inverse Angstroms!')endf=zeros(size(s));s1=find(s<=2);s2=find(s>2);if ~isempty(s1)	for j=1:5		f(s1)=f(s1)+ftable(z,j).*exp(-ftable(z,j+5).*s(s1).^2);	endendif ~isempty(s2)		for j=11:15		f(s2)=f(s2)+ftable(z,j).*exp(-ftable(z,j+5).*s(s2).^2);	endendf=f(:);